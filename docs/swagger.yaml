basePath: /
definitions:
  internal_app_controller.AddTaskRequest:
    properties:
      description:
        type: string
      expression:
        description: cron表达式或一次性执行的时间
        type: string
      retry_count:
        maximum: 10
        minimum: 0
        type: integer
      task_id:
        type: string
      type:
        enum:
        - cron
        - one_time
        type: string
    required:
    - task_id
    - type
    type: object
  internal_app_controller.CreatePaymentRequest:
    properties:
      amount:
        type: number
      currency:
        enum:
        - CNY
        - USD
        type: string
      description:
        type: string
      order_id:
        type: string
      payment_method:
        enum:
        - wechat_alipay
        type: string
    required:
    - amount
    - currency
    - order_id
    - payment_method
    type: object
  internal_app_controller.LoginRequest:
    properties:
      password:
        type: string
      username:
        type: string
    required:
    - password
    - username
    type: object
  internal_app_controller.PaymentResponse:
    properties:
      amount:
        type: number
      created_at:
        type: string
      currency:
        type: string
      description:
        type: string
      id:
        type: integer
      order_id:
        type: string
      payment_method:
        type: string
      status:
        type: string
      transaction_id:
        type: string
      updated_at:
        type: string
      user_id:
        type: integer
      wechat_pay_params:
        additionalProperties: true
        description: 微信支付相关参数
        type: object
    type: object
  internal_app_controller.RefreshTokenRequest:
    properties:
      refresh_token:
        type: string
    required:
    - refresh_token
    type: object
  internal_app_controller.RegisterRequest:
    properties:
      email:
        type: string
      password:
        maxLength: 30
        minLength: 6
        type: string
      username:
        maxLength: 50
        minLength: 3
        type: string
    required:
    - email
    - password
    - username
    type: object
  internal_app_controller.TaskResponse:
    properties:
      created_at:
        type: string
      description:
        type: string
      expression:
        type: string
      last_run_at:
        type: string
      max_retries:
        type: integer
      next_run_at:
        type: string
      retry_count:
        type: integer
      status:
        type: string
      task_id:
        type: string
      type:
        type: string
    type: object
  internal_app_controller.UserInfoResponse:
    properties:
      avatar:
        type: string
      email:
        type: string
      id:
        type: integer
      nickname:
        type: string
      phone:
        type: string
      role:
        type: string
      status:
        type: integer
      username:
        type: string
    type: object
  internal_app_controller.WechatLoginRequest:
    properties:
      code:
        type: string
    required:
    - code
    type: object
host: 127.0.0.1:8586
info:
  contact:
    email: support@example.com
    name: API Support
  description: 基于Gin和PostgreSQL的微信支付API服务
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  termsOfService: http://swagger.io/terms/
  title: 微信支付API服务
  version: "1.0"
paths:
  /api/v1/auth/login:
    post:
      consumes:
      - application/json
      description: 用户通过账号密码登录系统
      parameters:
      - description: 登录请求参数
        in: body
        name: login
        required: true
        schema:
          $ref: '#/definitions/internal_app_controller.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 登录成功，包含用户信息和令牌
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 认证失败
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 用户登录
      tags:
      - 用户管理
  /api/v1/auth/refresh-token:
    post:
      consumes:
      - application/json
      description: 使用refresh token获取新的access token和refresh token
      parameters:
      - description: 刷新令牌请求参数
        in: body
        name: refresh
        required: true
        schema:
          $ref: '#/definitions/internal_app_controller.RefreshTokenRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 刷新成功，包含新的令牌
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: 请求参数错误
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 认证失败
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 刷新令牌
      tags:
      - 用户管理
  /api/v1/auth/register:
    post:
      consumes:
      - application/json
      description: 创建新用户账户
      parameters:
      - description: 注册请求参数
        in: body
        name: register
        required: true
        schema:
          $ref: '#/definitions/internal_app_controller.RegisterRequest'
      produces:
      - application/json
      responses:
        "201":
          description: 注册成功
          schema:
            additionalProperties:
              $ref: '#/definitions/internal_app_controller.UserInfoResponse'
            type: object
        "400":
          description: 请求参数错误
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 用户注册
      tags:
      - 用户管理
  /api/v1/auth/wechat-login:
    post:
      consumes:
      - application/json
      description: 用户通过微信code进行登录
      parameters:
      - description: 微信登录请求参数
        in: body
        name: wechat
        required: true
        schema:
          $ref: '#/definitions/internal_app_controller.WechatLoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: 登录成功，包含用户信息和令牌
          schema:
            additionalProperties: true
            type: object
        "400":
          description: 请求参数错误
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 认证失败
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 微信登录
      tags:
      - 用户管理
  /api/v1/pay/notify/wechat:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 微信支付回调接口，用于处理支付结果通知
      produces:
      - text/xml
      responses:
        "200":
          description: 成功响应
          schema:
            type: string
      summary: 微信支付通知
      tags:
      - 支付管理
  /api/v1/payment:
    get:
      consumes:
      - application/json
      description: 获取当前登录用户的所有支付记录
      produces:
      - application/json
      responses:
        "200":
          description: 支付列表及分页信息
          schema:
            additionalProperties: true
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 获取用户支付列表
      tags:
      - 支付管理
    post:
      consumes:
      - application/json
      description: 创建一笔新的支付订单
      parameters:
      - description: 创建支付请求参数
        in: body
        name: payment
        required: true
        schema:
          $ref: '#/definitions/internal_app_controller.CreatePaymentRequest'
      produces:
      - application/json
      responses:
        "201":
          description: 支付创建成功
          schema:
            additionalProperties:
              $ref: '#/definitions/internal_app_controller.PaymentResponse'
            type: object
        "400":
          description: 请求参数错误
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 创建支付
      tags:
      - 支付管理
  /api/v1/payment/{id}:
    get:
      consumes:
      - application/json
      description: 根据ID查询支付详情
      parameters:
      - description: 支付ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 支付详情
          schema:
            additionalProperties:
              $ref: '#/definitions/internal_app_controller.PaymentResponse'
            type: object
        "400":
          description: 无效的支付ID
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 查询支付
      tags:
      - 支付管理
  /api/v1/payment/{id}/cancel:
    put:
      consumes:
      - application/json
      description: 根据ID取消一笔支付
      parameters:
      - description: 支付ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: 取消后的支付详情
          schema:
            additionalProperties:
              $ref: '#/definitions/internal_app_controller.PaymentResponse'
            type: object
        "400":
          description: 无效的支付ID
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 取消支付
      tags:
      - 支付管理
  /api/v1/task:
    get:
      consumes:
      - application/json
      description: 获取所有任务列表（管理员权限）
      produces:
      - application/json
      responses:
        "200":
          description: 任务列表
          schema:
            additionalProperties:
              items:
                $ref: '#/definitions/internal_app_controller.TaskResponse'
              type: array
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 获取所有任务
      tags:
      - 任务管理
    post:
      consumes:
      - application/json
      description: 添加一个定时任务或一次性任务（管理员权限）
      parameters:
      - description: 添加任务请求参数
        in: body
        name: task
        required: true
        schema:
          $ref: '#/definitions/internal_app_controller.AddTaskRequest'
      produces:
      - application/json
      responses:
        "201":
          description: 任务添加成功
          schema:
            additionalProperties:
              $ref: '#/definitions/internal_app_controller.TaskResponse'
            type: object
        "400":
          description: 请求参数错误
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 添加任务
      tags:
      - 任务管理
  /api/v1/task/{id}:
    delete:
      consumes:
      - application/json
      description: 根据ID移除一个任务（管理员权限）
      parameters:
      - description: 任务ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 任务移除成功
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 移除任务
      tags:
      - 任务管理
    get:
      consumes:
      - application/json
      description: 根据ID获取单个任务详情（管理员权限）
      parameters:
      - description: 任务ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 任务详情
          schema:
            additionalProperties:
              $ref: '#/definitions/internal_app_controller.TaskResponse'
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: 任务不存在
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 获取单个任务
      tags:
      - 任务管理
  /api/v1/task/{id}/retry:
    post:
      consumes:
      - application/json
      description: 根据ID重试一个失败的任务（管理员权限）
      parameters:
      - description: 任务ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 任务重试触发成功
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 重试任务
      tags:
      - 任务管理
  /api/v1/task/{id}/start:
    post:
      consumes:
      - application/json
      description: 根据ID启动一个任务（管理员权限）
      parameters:
      - description: 任务ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 任务启动成功
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 启动任务
      tags:
      - 任务管理
  /api/v1/task/{id}/stop:
    post:
      consumes:
      - application/json
      description: 根据ID停止一个任务（管理员权限）
      parameters:
      - description: 任务ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 任务停止成功
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: 无权限
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 停止任务
      tags:
      - 任务管理
  /api/v1/user/info:
    get:
      consumes:
      - application/json
      description: 获取当前登录用户的详细信息
      produces:
      - application/json
      responses:
        "200":
          description: 用户信息
          schema:
            additionalProperties:
              $ref: '#/definitions/internal_app_controller.UserInfoResponse'
            type: object
        "401":
          description: 未授权
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: 服务器内部错误
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 获取用户信息
      tags:
      - 用户管理
securityDefinitions:
  BearerAuth:
    in: header [Bearer ]
    name: Authorization
    type: apiKey
swagger: "2.0"
